!function(){var CD,util,path,insp,isArray,isFunction,isString,isPlainObject,isSolidArray,isSolidString,hasContent,obtain,includes,startsWith,endsWith,cmd,MODULE_TITLE,throwErrNonArray,throwErrNonStr,flagChar,reFlagStr,reShortFlag,reJoinedShortFlags,reLongFlag,__commands;function isShortFlag(flag){return reShortFlag.test(flag)}function isJoinedShortFlags(flag){return reJoinedShortFlags.test(flag)}function isLongFlag(flag){return reLongFlag.test(flag)}function _getLongFlagVarName(longFlag){return isSolidString(longFlag)?(longFlag=longFlag.replace(/^--/,"").replace(/^no-/i,""),isSolidString(longFlag)?longFlag.split("-").reduce(function(str,word){return str+word.charAt(0).toUpperCase()+word.slice(1)}):""):""}function _createOptionObjs(optsSchemas,isRequired){isArray(optsSchemas)||throwErrNonArray("_createOptionObjs",optsSchemas);var options=[];return isSolidArray(optsSchemas)&&optsSchemas.forEach(function(schema){var flagMatches=schema[0].match(reFlagStr);if(!isSolidArray(flagMatches))throw new Error("\nError: [Invalid OptionsSchema(flag)]: "+insp(schema)+"\n  at _createOptionObjs ("+MODULE_TITLE+")");var shortFlag=flagMatches[1],longFlag=flagMatches[2],shortFlag={name:_getLongFlagVarName(longFlag),shortFlag:shortFlag,longFlag:longFlag,description:schema[1]||"",isRequired:Boolean(isRequired),isSpecified:!1,isPairWithVal:!1,schema:schema,val:undefined},flagMatches=flagMatches[3].trim();if(/^--no-/i.test(longFlag))shortFlag.valType="SWITCH_NC",shortFlag.val=!0;else if(hasContent(flagMatches))if(/^<.+>$/i.test(flagMatches))shortFlag.isPairWithVal=!0,shortFlag.valSchema=flagMatches,shortFlag.valType="VALUE",endsWith(flagMatches,"...>")?(shortFlag.isArray=!0,shortFlag.val=[]):(shortFlag.isArray=!1,shortFlag.val=undefined);else{if(!/^\[.+\]$/i.test(flagMatches))throw new Error("\nError: [Invalid OptionsSchema(val)]: "+insp(schema)+"\n  at _createOptionObjs ("+MODULE_TITLE+")");shortFlag.valSchema=flagMatches,shortFlag.valType="VALUE",endsWith(flagMatches,"...]")?(shortFlag.isArray=!0,shortFlag.val=[]):(shortFlag.isArray=!1,shortFlag.val=undefined)}else shortFlag.valType="SWITCH_NO",shortFlag.val=!1;2<schema.length&&(isFunction(schema[2])?(shortFlag.initFunc=schema[2],3<schema.length&&(shortFlag.isArray?shortFlag.val=[schema[3]]:shortFlag.val=schema[3],shortFlag.isPairWithVal=!1)):(shortFlag.isArray?shortFlag.val=[schema[2]]:shortFlag.val=schema[2],shortFlag.isPairWithVal=!1)),options.push(shortFlag)}),options}Wsh&&Wsh.Commander||(Wsh.Commander={},CD=Wsh.Constants,util=Wsh.Util,path=Wsh.Path,insp=util.inspect,isArray=util.isArray,isFunction=util.isFunction,isString=util.isString,isPlainObject=util.isPlainObject,isSolidArray=util.isSolidArray,isSolidString=util.isSolidString,hasContent=util.hasContent,obtain=util.obtainPropVal,includes=util.includes,startsWith=util.startsWith,endsWith=util.endsWith,cmd=Wsh.Commander,MODULE_TITLE="WshCore/Commander.js",throwErrNonArray=function(functionName,typeErrVal){util.throwTypeError("array",MODULE_TITLE,functionName,typeErrVal)},throwErrNonStr=function(functionName,typeErrVal){util.throwTypeError("string",MODULE_TITLE,functionName,typeErrVal)},flagChar="[0-9_.,!?+*$a-zA-Z]",reFlagStr=new RegExp("(-"+flagChar+")?[,\\s]\\s?(--\\S+)\\s*(\\S*)","i"),reShortFlag=new RegExp("^-("+flagChar+")$","i"),reJoinedShortFlags=new RegExp("^-("+flagChar+"{2,})$","i"),reLongFlag=new RegExp("^--("+flagChar+"+(-"+flagChar+"+)*)$","i"),__commands=[],cmd._getCommandObjects=function(){return __commands},cmd.addProgram=function(schemaObj){isPlainObject(schemaObj)||!function(functionName,typeErrVal){util.throwTypeError("object",MODULE_TITLE,functionName,typeErrVal)}("cmd.addProgram",schemaObj);var commandSchema=obtain(schemaObj,"command",""),optionsSchema=obtain(schemaObj,"options",[]),requiredOptions=obtain(schemaObj,"requiredOptions",[]);if(!isString(commandSchema)&&!hasContent(optionsSchema)&&!hasContent(requiredOptions))throw new Error("\nError: [Invalid Schema]: Empty of command and options\n  at cmd.addProgram ("+MODULE_TITLE+")");var cmdObj=function(cmdSchema){isString(cmdSchema)||throwErrNonStr("_createCmdObj",cmdSchema);var cmdObj={name:"",description:"",args:[],version:{},help:{},options:[]};if(!isSolidString(cmdSchema))return cmdObj;var matches=cmdSchema.match(/(\S+)\s*(.*)/i),userCmdSchema=matches[1];if(isSolidString(userCmdSchema))return cmdObj.name=userCmdSchema,userCmdSchema=matches[2],isSolidString(userCmdSchema)&&userCmdSchema.split(/\s+/).forEach(function(argSchema){var argMatches=argSchema.match(/^([<[])(\S+)([>\]])$/i);if(!isSolidArray(argMatches))throw new Error("\nError: [Invalid CommandSchema(arg)]: "+cmdSchema+"\n  at _createCmdObj ("+MODULE_TITLE+")");var argOpen=argMatches[1],argName=argMatches[2],argMatches=argMatches[3];if(!isSolidString(argOpen)||!isSolidString(argName)||!isSolidString(argMatches))throw new Error("\nError: [Invalid CommandSchema(argVal)]: "+cmdSchema+"\n  at _createCmdObj ("+MODULE_TITLE+")");argSchema={name:argName,isSpecified:!1,isRequired:!1,schema:argSchema,val:undefined};if("<"===argOpen&&">"===argMatches)argSchema.isRequired=!0;else{if("["!==argOpen||"]"!==argMatches)throw new Error("\nError: [Invalid CommandSchema](argType): "+cmdSchema+"\n  at _createCmdObj ("+MODULE_TITLE+")");argSchema.isRequired=!1}endsWith(argName,"...")&&(argSchema.isArray=!0,argSchema.val=[]),cmdObj.args.push(argSchema)}),cmdObj;throw new Error("\nError: [Invalid CommandSchema(main)]: "+cmdSchema+"\n  at _createCmdObj ("+MODULE_TITLE+")")}(commandSchema);if(__commands.some(function(o){return o.name===cmdObj.name}))throw new Error('\nError: [Invalid Command Name] "'+cmdObj.name+'" is already existing\n  at cmd.addProgram ('+MODULE_TITLE+")");commandSchema=obtain(schemaObj,"description",""),cmdObj.description=commandSchema,commandSchema=obtain(schemaObj,"version",""),cmdObj.version=function(versionSchema){if(!hasContent(versionSchema))return{};var verOptObj={name:"version",shortFlag:"-V",longFlag:"--version",description:"Output the version number",schema:versionSchema};if(isString(versionSchema))return verOptObj.val=versionSchema,verOptObj;isArray(versionSchema)||throwErrNonArray("_creatVersionOptionObj",versionSchema),verOptObj.val=versionSchema[0];var flagMatches=versionSchema[1].match(reFlagStr);if(hasContent(flagMatches))return verOptObj.shortFlag=flagMatches[1],verOptObj.longFlag=flagMatches[2],hasContent(versionSchema[3])&&(verOptObj.description=versionSchema[3]),verOptObj;throw new Error("\nError: [Invalid VersionSchema]: "+insp(versionSchema)+"\n  at _creatVersionOptionObj ("+MODULE_TITLE+")")}(commandSchema),cmdObj.options=[].concat(_createOptionObjs(requiredOptions,!0)),cmdObj.options=cmdObj.options.concat(_createOptionObjs(optionsSchema,!1)),commandSchema=obtain(schemaObj,"helpOption",[]),cmdObj.help=function(helpOptSchema){isArray(helpOptSchema)||throwErrNonArray("_createHelpOptionObj",helpOptSchema);var helpOptObj={name:"help",shortFlag:"-h",longFlag:"--help",description:"Output usage information",val:undefined,schema:helpOptSchema};if(!isSolidArray(helpOptSchema))return helpOptObj;isSolidString(helpOptSchema[0])||throwErrNonStr("_createHelpOptionObj",helpOptSchema);var flagMatches=helpOptSchema[0].match(reFlagStr);if(hasContent(flagMatches))return helpOptObj.shortFlag=flagMatches[1],helpOptObj.longFlag=flagMatches[2],isSolidString(helpOptSchema[1])&&(helpOptObj.description=helpOptSchema[1]),helpOptObj;throw new Error("\nError: [Invalid HelpOptionSchema(flag)]: "+insp(helpOptSchema)+"\n  at _createHelpOptionObj ("+MODULE_TITLE+")")}(commandSchema),cmdObj.help.val=function(cmdObj){var maxWidth,helpMsg="Usage: ",optObjs=(""===cmdObj.name?helpMsg+=path.basename(process.argv[1]):helpMsg=(helpMsg+=cmdObj.name)+cmdObj.args.reduce(function(acc,arg){return acc+" "+arg.schema},""),cmdObj.options.concat([{shortFlag:cmdObj.help.shortFlag,longFlag:cmdObj.help.longFlag,description:cmdObj.help.description,valSchema:undefined,val:undefined}]));return hasContent(cmdObj.version)&&optObjs.unshift({shortFlag:cmdObj.version.shortFlag,longFlag:cmdObj.version.longFlag,description:cmdObj.version.description,valSchema:undefined,val:undefined}),helpMsg+=" [options]\n\n",hasContent(cmdObj.description)&&(helpMsg+=cmdObj.description+"\n\n"),0<optObjs.length&&(helpMsg+="Options:\n",maxWidth=0,optObjs.forEach(function(opt){var width=String(opt.longFlag).length;width+=opt.valSchema?String(opt.valSchema).length+1:0,maxWidth<width&&(maxWidth=width)}),helpMsg+=optObjs.reduce(function(acc,opt){hasContent(opt.shortFlag)?acc+="  "+opt.shortFlag+",":acc+="    ,",acc=(acc+=" "+opt.longFlag)+(opt.valSchema?" "+opt.valSchema:"");for(var i=opt.longFlag.length+(opt.valSchema?String(opt.valSchema).length+1:0);i<maxWidth;i++)acc+=" ";return hasContent(opt.description)&&(acc+=" "+opt.description),hasContent(opt.val)&&"SWITCH_NC"!==opt.valType&&(acc+=" (default: "+insp(opt.val)+")"),acc+="\n"},"")),helpMsg}(cmdObj),requiredOptions=obtain(schemaObj,"action",null);isFunction(requiredOptions)?cmdObj.action=requiredOptions:cmdObj.action=null,__commands.push(cmdObj)},cmd.addPrograms=function(schemaObjs){isSolidArray(schemaObjs)||throwErrNonArray("cmd.addPrograms",schemaObjs),schemaObjs.forEach(function(schemaObj){cmd.addProgram(schemaObj)})},cmd.opt={},cmd.parse=function(processArgv){isArray(processArgv)||throwErrNonArray("cmd.parse",processArgv);var args=Array.from(processArgv);if(args.shift()===undefined)throw new Error("\nError: [Invalid Arguments(exePath)] "+insp(processArgv)+"\n  at cmd.parse ("+MODULE_TITLE+")");if(args.shift()===undefined)throw new Error("\nError: [Invalid Arguments(wshPath)] "+insp(processArgv)+"\n  at cmd.parse ("+MODULE_TITLE+")");var matchedOptIdxs,matchedCmdObj=null,processArgv=__commands.findIndex(function(cmd){return""===cmd.name});if(-1!==processArgv&&(matchedCmdObj=__commands[processArgv]),0<args.length&&(-1!==(processArgv=__commands.findIndex(function(cmd){return cmd.name===args[0]}))&&(matchedCmdObj=__commands[processArgv],args.shift())),null===matchedCmdObj)throw processArgv=__commands.reduce(function(acc,cmdObj,i){return 0===i?cmdObj.name:acc+", "+cmdObj.name},""),new Error("\nERROR: Set a command.\nwhere <command> is one of:\n    "+processArgv+"\n\nprocess.argv: ["+process.argv.join(", ")+"]");for(var arg,opt,matchedArgObjIdx,cmdArgs,options,reserveOptIdx=-1;0<args.length&&(arg=args.shift())!==undefined;){if(-1!==reserveOptIdx)if(opt=matchedCmdObj.options[reserveOptIdx],startsWith(arg,"-")&&!opt.isPairWithVal)reserveOptIdx=-1;else{if(!opt.isArray){isFunction(opt.initFunc)?opt.val=opt.initFunc(arg,opt.val):opt.val=arg,reserveOptIdx=-1;continue}startsWith(arg,"-")?reserveOptIdx=-1:isFunction(opt.initFunc)?opt.val.push(opt.initFunc(arg,opt.val)):opt.val.push(arg)}startsWith(arg,"-")?(function(cmdObj,arg){var shows,sFlag=cmdObj.help.shortFlag,lFlag=cmdObj.help.longFlag;isShortFlag(arg)?shows=arg===sFlag:isJoinedShortFlags(arg)?shows=includes(arg,sFlag.substring(1)):isLongFlag(arg)&&(shows=arg===lFlag),shows&&(console.log(cmdObj.help.val),process.exit(CD.runs.ok))}(matchedCmdObj,arg),function(cmdObj,arg){var sFlag,lFlag,shows;hasContent(cmdObj.version)&&(sFlag=cmdObj.version.shortFlag,lFlag=cmdObj.version.longFlag,isShortFlag(arg)?shows=arg===sFlag:isJoinedShortFlags(arg)?shows=includes(arg,sFlag.substring(1)):isLongFlag(arg)&&(shows=arg===lFlag),shows&&(console.log(cmdObj.version.val),process.exit(CD.runs.ok)))}(matchedCmdObj,arg),matchedOptIdxs=[],isShortFlag(arg)?matchedOptIdxs.push(matchedCmdObj.options.findIndex(function(opt){return opt.shortFlag===arg})):isJoinedShortFlags(arg)?matchedCmdObj.options.forEach(function(opt,idx){includes(opt.shortFlag,arg.substring(1))&&matchedOptIdxs.push(idx)}):isLongFlag(arg)&&matchedOptIdxs.push(matchedCmdObj.options.findIndex(function(opt){return opt.longFlag===arg})),matchedOptIdxs.forEach(function(idx){if(-1===idx)throw new Error('\nError: [Invalid Option] "'+arg+'"\n  at cmd.parse ('+MODULE_TITLE+")\n"+matchedCmdObj.help.val);if((opt=matchedCmdObj.options[idx]).isSpecified=!0,"SWITCH_NC"===opt.valType)isFunction(opt.initFunc)?opt.val=opt.initFunc(undefined,opt.val):opt.val=!1;else if("SWITCH_NO"===opt.valType)isFunction(opt.initFunc)?opt.val=opt.initFunc(undefined,opt.val):opt.val=!0;else{if("VALUE"!==opt.valType)throw new Error('\nError: Unknown option valType "'+opt.valType+'"\n  at cmd.parse ('+MODULE_TITLE+")\n"+matchedCmdObj.help.val);opt.isArray||opt.isPairWithVal||opt.val||(opt.val=!0),reserveOptIdx=idx}})):-1!==(matchedArgObjIdx=matchedCmdObj.args.findIndex(function(argObj){return!!argObj.isArray||argObj.val===undefined}))&&((matchedArgObjIdx=matchedCmdObj.args[matchedArgObjIdx]).isSpecified=!0,matchedArgObjIdx.isArray?matchedArgObjIdx.val.push(arg):matchedArgObjIdx.val=arg)}if(matchedCmdObj.args.some(function(arg){if(!arg.isRequired)return!1;if(!hasContent(arg.val))throw new Error('\nerror: missing required argument "'+arg.name+'"\n'+matchedCmdObj.help.val)}),matchedCmdObj.options.some(function(opt){if(opt.isRequired&&!hasContent(opt.val))throw new Error('\nerror: option "'+opt.schema[0]+'" argument missing\n'+matchedCmdObj.help.val);if(opt.isSpecified&&opt.isPairWithVal&&opt.val===undefined)throw new Error('\nerror: option "'+opt.schema[0]+'" argument missing\n'+matchedCmdObj.help.val)}),matchedCmdObj.options.forEach(function(opt){cmd.opt[opt.name]=opt.val}),isFunction(matchedCmdObj.action))return cmdArgs=[],matchedCmdObj.args.forEach(function(argObj){argObj.isSpecified?cmdArgs.push(argObj.val):cmdArgs.push(undefined)}),hasContent(matchedCmdObj.options)?(options={},matchedCmdObj.options.forEach(function(opt){options[opt.name]=opt.val}),matchedCmdObj.action.apply(null,cmdArgs.concat([options]))):matchedCmdObj.action.apply(null,cmdArgs)},cmd.help=function(callback){isFunction(callback)&&callback(),console.log(__commands.help.val),process.exit(CD.runs.err)},cmd.clearPrograms=function(){cmd.opt={},__commands=[]})}();
